{"version":3,"sources":["main.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"tolerance.js","sourcesContent":["var app = angular.module('ToleranceApp', [])\n                  .constant('API_URL', 'http://dopusk.local/admin/api/v1/');\n\napp.service('orderedQualities', function(){\n  var array = [];\n  var set = function(val){\n    array = val;\n  };\n  var get = function(){\n    return array;\n  };\n  return {\n    set: set,\n    get: get\n  };\n});\n\napp.controller('ToleranceAppCtrl', function($scope, $http, API_URL, orderedQualities){\n  $http.get(API_URL + 'tolerances').success(buildGrid);\n\n  function buildGrid(responce){\n    $scope.tolerances = responce;\n    $scope.ranges = getKeys($scope.tolerances);\n    $scope.systems = getKeys($scope.tolerances[$scope.ranges[0]]);\n    $scope.qualities = getKeys($scope.tolerances[$scope.ranges[0]][$scope.systems[0]]);\n    $scope.fields = getKeys($scope.tolerances[$scope.ranges[0]][$scope.systems[0]][[$scope.qualities[0]]]);\n    $scope.cur_range = $scope.ranges[0];\n    $scope.cur_system = $scope.systems[0];\n    $scope.refreshGrid();\n    console.log($scope.ranges);\n    console.log($scope.systems);\n  }\n\n  $scope.refreshGrid = function(){\n    console.log($scope.cur_range);\n    orderedQualities.set([]);\n    $scope.grid = $scope.tolerances[$scope.cur_range][$scope.cur_system];\n    resetCurItemForm();\n  };\n\n  $scope.editField = function(item, field_name, quality_name){\n    $scope.cur_max_val = item['max'];\n    $scope.cur_min_val = item['min'];\n    $scope.cur_item = item;\n    $scope.cur_field_name = field_name;\n    $scope.cur_quality_name = quality_name;\n  };\n\n  $scope.updateField = function(){\n    $scope.cur_item['max'] = $scope.cur_max_val;\n    $scope.cur_item['min'] = $scope.cur_min_val;\n  };\n\n  $scope.fieldBySystem = function(text){\n    if($scope.cur_system == 'hole'){\n      return text.toUpperCase();\n    }\n    return text;\n  }\n\n  function getKeys(arr) {\n    var res = [];\n    for (var key in arr) {\n      res.push(key);\n    }\n    return res;\n  }\n\n  function resetCurItemForm(){\n    $scope.cur_max_val = '';\n    $scope.cur_min_val = '';\n    $scope.cur_item = undefined;\n    $scope.cur_field_name = '';\n    $scope.cur_quality_name = '';\n  }\n});\n\napp.filter('orderQualities', function(orderedQualities){\n  return function(items){\n    var arr = orderedQualities.get();\n    if (!arr.length) {\n      angular.forEach(items, function(item, key){\n        arr.push({\n          name: key,\n          fields: item\n        });\n      });\n      arr = arr.sort(function(a,b){\n        if(a.name === '01'){ return -1 }\n        if(b.name === '01'){ return 1 }\n        return (parseFloat(a.name) < parseFloat(b.name))? -1: 1;\n      });\n      orderedQualities.set(arr);\n    }\n    return arr;\n  }\n});\n"]}